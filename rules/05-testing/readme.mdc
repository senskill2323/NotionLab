---
title: "NotionLab Guide IA - Module Formations"
version: "2"
date: "2025-01-18"
owner: "NEEDS-VERIFY Provide owner or primary contact."
description: Stratégie tests en pyramide : unit, intégration, e2e, API contracts, mocks Supabase, accessibilité, performance, visuels, fixtures, seeds, test-IDs, coverage.
---

<!-- AUTO:BEGIN -->
<!-- ANCHOR:OVERVIEW -->
readmeIA ne documente pas de strategie de tests automatisee pour le module Formations.

<!-- ANCHOR:STANDARDS -->
- Standards Onboarding formation:
  - Tests E2E manuels rapides pour le wizard: navigation étapes, autosauvegarde (message « Brouillon enregistré »), soumission et redirection.
  - Vérification notifications: soumission 1 → objet « Nouveau brief… »; resoumission → « Brief mis à jour… ».
  - Accessibilité: focus visible sur cartes/boutons, `aria-live="polite"` pour l'état d'enregistrement, `fieldset/legend` et labels.
  - Résumé client/admin: cohérence des valeurs formatées (y compris « Autre » + texte libre), pictogrammes présents.
  - RLS: le client ne peut lire/écrire que ses propres réponses; l'admin a lecture seule.
- Standards Assistant IA:
  - Tests manuels drawer: bouton nav (ou module dashboard) ouvre/ferme le panneau, changement d'etat Appeler/Raccrocher/Webcam.
  - Edge Function: verifier que `assistant-mint-key` renvoie bien un 200 (secret, session, iceServers) et que les preflight OPTIONS passent.
  - WebRTC: lancer un appel avec/ sans video, confirmer la presence des flux remote/local et le fallback quand aucun ice server n'est fourni.
  - Quotas: ajuster `assistant_limits` pour tester limites minutes/session/images; confirmer le message user-friendly et la mise a jour `assistant_metrics`.
  - Observabilite: regarder `assistant_metrics` (duree/images/bytes) apres chaque appel et logs edge (erreurs OpenAI).

<!-- ANCHOR:WORKFLOWS -->
- Journaux/Observabilité:
  - Supabase Dashboard → Logs → Edge Functions: observer la fenêtre d’1 minute après soumission.
  - En fallback (absence de `RESEND_API_KEY`), la fonction loggue `delivered: false`.
<!-- ANCHOR:EXAMPLES -->
```txt
Checklist rapide E2E Onboarding
- Connexion client actif OK
- Wizard: autosauvegarde (message), étapes navigables
- Soumission 1: toast, NPS affiché, résumé conforme
- Email 1: reçu « Nouveau brief d’onboarding… »
- Resoumission: email « Brief d’onboarding mis à jour… »
- Résumé admin: affiche les mêmes valeurs (lecture seule)
```

<!-- ANCHOR:LIMITS -->
- L'absence de documentation sur les tests laisse un risque de couverture inconnue.
 - A11y non instrumentée en tests automatisés; prévoir une passe d’audit manuel (axe DevTools) avant mise en prod.
 - Les logs Edge sont fugaces (~1 min); réaliser les vérifications immédiatement après soumission.
