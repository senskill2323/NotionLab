---
title: "NotionLab Guide IA - Module Formations"
version: "2"
date: "2025-01-18"
owner: "NEEDS-VERIFY Provide owner or primary contact."
description: Stratégie tests en pyramide : unit, intégration, e2e, API contracts, mocks Supabase, accessibilité, performance, visuels, fixtures, seeds, test-IDs, coverage.
---

<!-- AUTO:BEGIN -->
<!-- ANCHOR:OVERVIEW -->
readmeIA ne documente pas de strategie de tests automatisee pour le module Formations.

<!-- ANCHOR:STANDARDS -->
- Standards Onboarding formation:
  - Tests E2E manuels rapides pour le wizard: navigation étapes, autosauvegarde (message « Brouillon enregistré »), soumission et redirection.
  - Vérification notifications: soumission 1 → objet « Nouveau brief… »; resoumission → « Brief mis à jour… ».
  - Accessibilité: focus visible sur cartes/boutons, `aria-live="polite"` pour l'état d'enregistrement, `fieldset/legend` et labels.
  - Résumé client/admin: cohérence des valeurs formatées (y compris « Autre » + texte libre), pictogrammes présents.
  - RLS: le client ne peut lire/écrire que ses propres réponses; l'admin a lecture seule.

<!-- ANCHOR:WORKFLOWS -->
- Scénario E2E (manuel):
  1) Se connecter avec un compte client actif.
  2) Ouvrir `/mes-preferences-formation/editer`, répondre à plusieurs questions (incluant au moins un « Autre »), vérifier le message « Brouillon enregistré ».
  3) Cliquer « Valider mes réponses »; vérifier le toast de succès puis l'ouverture du NPS (première soumission).
  4) Répondre au NPS (Oui/Non + commentaire optionnel); fermer → redirection vers le résumé.
  5) Contrôler la réception de l'email à `ONBOARDING_NOTIFICATION_EMAIL` (ou fallback `OWNER_EMAIL`) et les logs Edge Function.
  6) Rééditer et re‑valider → vérifier l'email « Brief d’onboarding mis à jour – … ».

- Journaux/Observabilité:
  - Supabase Dashboard → Logs → Edge Functions: observer la fenêtre d’1 minute après soumission.
  - En fallback (absence de `RESEND_API_KEY`), la fonction loggue `delivered: false`.

<!-- ANCHOR:EXAMPLES -->
```txt
Checklist rapide E2E Onboarding
- Connexion client actif OK
- Wizard: autosauvegarde (message), étapes navigables
- Soumission 1: toast, NPS affiché, résumé conforme
- Email 1: reçu « Nouveau brief d’onboarding… »
- Resoumission: email « Brief d’onboarding mis à jour… »
- Résumé admin: affiche les mêmes valeurs (lecture seule)
```

<!-- ANCHOR:LIMITS -->
- L'absence de documentation sur les tests laisse un risque de couverture inconnue.
 - A11y non instrumentée en tests automatisés; prévoir une passe d’audit manuel (axe DevTools) avant mise en prod.
 - Les logs Edge sont fugaces (~1 min); réaliser les vérifications immédiatement après soumission.
<!-- AUTO:END -->
